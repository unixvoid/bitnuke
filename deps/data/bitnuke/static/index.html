<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8">
    <title>bitnuke</title>
    <link rel="shortcut icon" type="image/png" href="static/favicon.png">
    <link rel="stylesheet" href="static/style.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  </head>

  <div class=tint>
    <body class=bg>
      <script src="static/dropzone.js"></script>
      <link rel="stylesheet" href="static/dropzone.css">

      <center><img src="static/bitnuke.png" alt="bitnuke.io" id=logo></center>

      <center>
      <div id="dropzone">
        <form id="droppy" class="dropzone" action="/upload">
          <div class="dz-message dropmsg">
            </br>Drop or click to upload
          </div>
        </form>
      </div></br>
      <div id=writezone></div>
      </br>
      <div id=writezone2></div>
      </center>

      <script>
        function removeLink(file_id, sec_key, removal_key) {
          //console.log(removal_key);
          // do a post to /remove
          var xhttp = new XMLHttpRequest();
          xhttp.open("POST", "/remove", true);
          xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
          xhttp.send("file_id=" + file_id +
              "&sec_key=" + sec_key +
              "&removal_key=" + removal_key);

          // reload the table
        }

        Dropzone.options.droppy = {
        method: "post",
        maxFilesize: 512,
        autoDiscover: false,
          init: function() {
            this.on("success", function(file, response) {
              this.removeAllFiles();
              document.getElementById("writezone").innerHTML = (window.location.protocol + '//' + window.location.hostname + '/' + response).link(window.location.protocol + '//' + window.location.hostname + ':' + window.location.port + '/' + response);
            });
          }
        };

        console.log("bitnuke.io")
        console.log("see you in 12 hours...")

        // initiate data table
        var targetTable = "<table><tr><th>Link</th><th>Delete</th></tr>";
        var allCookies = document.cookie.split(';');
        if (allCookies != "") {
          for (var i = 0 ; i < allCookies.length; i++) {
            var tmpCookie = allCookies[i].split(/=(.+)/);
            var name = tmpCookie[0];
            name = name.replace(/\s+/g, '');       // remove spaces
            encodedString = tmpCookie[1]
            decodedString = atob(encodedString);
            var value = JSON.parse(decodedString);

            // build table with data
            targetTable += '<tr><td><a id='+value.file_name+' href="/'+name+'/'+value.sec_key+'">'+value.file_name+'</a></td>';
            targetTable += '<td id=removal><a href="#" onclick="removeLink(\''+name+'\',\''+value.sec_key+'\',\''+value.removal_key+'\');">ðŸ—™ </a</td></tr>';

          }
          targetTable += '</table>';
          document.getElementById("writezone2").innerHTML = targetTable;
        }
      </script>
      <div class=footer>
        <center>
            <div class=leftfoot>
              Volatile file storage powered by <a class=flink href="https://unixvoid.com">unixvoid.com</a>
              <a class=flink href="https://github.com/unixvoid/bitnuke">//v0.10.4</a>
            </div>
            <div class=rightfoot>
              <a class=flink href="/persist">//persistent_uploads</a>
              <a class=flink href="/link">//link_shortener</a>
              <a class=flink class=button href="#about">//about</a>
            </div>
        </center>
      </div>
      <div id=about class=overlay>
        <div class="popup">
          <a class="close" href="#">x</a>
          <div class=popupcontent>
            bitnuke.io is an anonymous temporary file storage site. Your files are stored for 12 hours and then deleted permanently.
          </div>
        </div>
      </div>
    </body>
  </div>
</html>
